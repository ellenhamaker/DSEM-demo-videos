# Code to create Figure 2 in the manuscript

results <- matrix(,20,8)


for (k in 1:20){
  cov <- 1    # person-specific covariance between X and Y for all people
  
  # First half of the population:
  var1 <- 2.5           # person-specific variance for X and Y in half of the people
  cor1 <- cov/var1    # person-specific correlation in first half (is 0.1)
             
  # Second half of the population:
  var2 <- k           # person-specific variance in second half of the people
  cor2 <- cov/var2    # person-specific correlation in second half (runs from 1 to (about) zero)
  
  # Average person-specific correlation
  kappa <- (cor1+cor2)/2  # average of the two subpopulations
  
  # Correlation of the within-person deviations from WABA expressions
  var.W <- (var1+var2)/2     # average person-specific variance for X and Y
  rho.W <- cov/var.W         # WP correlation
 
  results[k,] <- c(1/var1,1/var2,1/var.W,cor1,cor2,kappa,rho.W,kappa-rho.W)
  
  
}

round(results,2)

# Plot
plot(results[,2],results[,4], 
     main = expression(paste(kappa[1], ", " , kappa[2], ", ", kappa, ", ",
                             " and ", rho[W])), 
     ylab="Correlation", 
     xlab = "Q",
     type="l",ylim=c(0,1),lwd=2)
lines(results[,2],results[,5], lwd=2, lty=1)
lines(results[,2],results[,6], lwd=2, lty=2)
lines(results[,2],results[,7], lwd=2, lty=3)
  
# Two solid lines represent the correlations kappa1 and kappa2 in the two subpopulations
# The dashed line represents the average person-specific correlation kappa; this falls exactly
# in between kappa1 and kappa2, as the two subpopulations each make up half of the population
# The dotted line represents the correlation of within-person deviations (i.e., the within-
# person correlation rhoW from the WABA expression)
  